<view class="container">

  <!-- 主体内容：左右分栏 -->
  <view class="main-content" wx:if="{{orderList.length > 0 || isLoading}}">
    <!-- 左侧导航 -->
    <scroll-view scroll-y class="side-menu">
      <view 
        wx:for="{{orderGroups}}" 
        wx:key="id" 
        class="menu-item {{activeGroupId === item.id ? 'active' : ''}}"
        data-id="{{item.id}}"
        bindtap="onMenuClick"
      >
        <text class="menu-title">{{item.title}}</text>
        <text class="menu-count" wx:if="{{item.count > 0}}">{{item.count}}</text>
      </view>
    </scroll-view>

    <!-- 右侧列表 -->
    <scroll-view 
      scroll-y 
      class="content-area" 
      scroll-into-view="{{scrollIntoViewId}}" 
      scroll-with-animation
      bindscrolltolower="onReachBottom"
    >
      <view class="group-list">
        <view 
          wx:for="{{orderGroups}}" 
          wx:key="id" 
          wx:for-item="group"
          class="order-group" 
          id="group-{{group.id}}"
        >
          <!-- 分组标题 -->
          <view class="group-header" data-id="{{group.id}}" bindtap="toggleGroup">
            <text class="group-title">{{group.title}}</text>
            <view class="group-action">
              <text class="group-count">{{group.count}}单</text>
              <text class="group-arrow {{group.isExpanded ? 'expanded' : ''}}">▼</text>
            </view>
          </view>

          <!-- 分组内容 -->
          <view class="group-content" hidden="{{!group.isExpanded}}">
            <view wx:if="{{group.orders.length === 0}}" class="group-empty">
              <text>暂无订单</text>
            </view>
            <view wx:else class="order-items">
              <view class="order-item" wx:for="{{group.orders}}" wx:key="orderId" data-order="{{item}}" bindtap="onOrderClick">
                <view class="order-header">
                  <text class="order-no">{{item.orderNo}}</text>
                  <text class="order-status {{item.status}}">{{item.statusText}}</text>
                </view>
                
                <view class="order-info">
                  <view class="info-item">
                    <text class="info-label">订单金额：</text>
                    <text class="info-value price">{{item.rmbAmount}}</text>
                  </view>
                  <view class="info-item">
                    <text class="info-label">下单日期：</text>
                    <text class="info-value">{{item.orderDate}}</text>
                  </view>
                  <view class="info-item">
                    <text class="info-label">交货日期：</text>
                    <text class="info-value">{{item.deliveryDate}}</text>
                  </view>
                  <view class="info-item" wx:if="{{item.remark}}">
                    <text class="info-label">备注信息：</text>
                    <text class="info-value remark">{{item.remark}}</text>
                  </view>
                </view>
                
                <view class="order-progress">
                  <text class="progress-label">发货进度</text>
                  <view class="progress-bar">
                    <view class="progress-fill" style="width: {{item.shippedRate}}%"></view>
                  </view>
                  <text class="progress-text">{{item.shippedRate}}%</text>
                  <text class="delivery-status-tag status-{{item.deliveryStatus}}">{{item.deliveryStatusText}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <view wx:if="{{isLoadingMore}}" class="loading-more">
          <view class="loading-spinner"></view>
          <text class="loading-text">加载中...</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 空状态 -->
  <view wx:elif="{{!isLoading}}" class="empty-state">
    <image class="empty-icon" src="/images/icon-empty.png"></image>
    <text class="empty-text">暂无订单数据</text>
    <text class="empty-subtext">您可以尝试搜索或下拉刷新</text>
  </view>
</view>

<!-- 加载遮罩 -->
<view class="loading-overlay" wx:if="{{isLoading && !isRefreshing}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{loadingText}}</text>
  </view>
</view>

<!-- 企业绑定弹窗（样式沿用登录页） -->
<view class="erp-bind-section" wx:if="{{showBindCompany}}">
  <view class="bind-modal">
    <view class="modal-header">
      <text class="modal-title">绑定企业信息</text>
      <image class="close-btn" src="/images/icon-close.png" bindtap="onCloseBindCompany"></image>
    </view>
    <view class="modal-content">
      <input class="input-field" placeholder="请输入微信邀请码" value="{{inviteCode}}" bindinput="onInviteCodeInput" />
      <button class="bind-btn" bindtap="onBindCompanyTap">绑定</button>
    </view>
  </view>
</view>